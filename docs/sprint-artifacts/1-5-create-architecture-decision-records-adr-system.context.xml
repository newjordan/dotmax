<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.5</storyId>
    <title>Create Architecture Decision Records (ADR) System</title>
    <status>drafted</status>
    <generatedAt>2025-11-17</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-5-create-architecture-decision-records-adr-system.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>solo developer who may resume work after months</asA>
    <iWant>documented architecture decisions with context and rationale</iWant>
    <soThat>I understand WHY choices were made when I return to the project</soThat>
    <tasks>
      - Task 1: Create ADR README with index and guidelines (AC: #2, #10)
      - Task 2: Create ADR template (AC: #3, #5)
      - Task 3: Create first ADR - Braille Unicode for Rendering (AC: #4, #6, #7, #8, #9)
      - Task 4: Verify ADR system is usable and complete (AC: #1-10)
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">docs/adr/ directory exists (already created, verify structure)</criterion>
    <criterion id="2">docs/adr/README.md exists with ADR index and usage guidelines</criterion>
    <criterion id="3">docs/adr/template.md exists with standard ADR template structure</criterion>
    <criterion id="4">docs/adr/0001-use-braille-unicode-for-rendering.md exists as first ADR</criterion>
    <criterion id="5">ADR template includes sections: Status, Context, Decision, Consequences, Alternatives Considered</criterion>
    <criterion id="6">First ADR (0001) documents decision to use Unicode braille (U+2800-U+28FF) for terminal rendering</criterion>
    <criterion id="7">First ADR explains context: need cross-platform terminal graphics without protocol dependencies</criterion>
    <criterion id="8">First ADR lists consequences: 2×4 resolution per cell, requires Unicode support, text-based output</criterion>
    <criterion id="9">First ADR documents alternatives considered: Sixel (limited support), Kitty protocol (tmux breaks), ASCII art (lower resolution)</criterion>
    <criterion id="10">docs/adr/README.md maintains index of all ADRs with quick summaries</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document - dotmax</title>
        <section>NFR-M2: Resumable Development</section>
        <snippet>The project must be designed so that the solo developer can resume work after months-long gaps without losing context or making contradictory decisions. This requires comprehensive documentation of WHY decisions were made, not just WHAT was implemented.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document - dotmax</title>
        <section>System Architecture</section>
        <snippet>Core rendering approach uses Unicode braille characters (U+2800-U+28FF) for universal terminal compatibility. Each terminal cell represents a 2×4 grid of braille dots, providing 8 individually addressable pixels per character cell.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document - dotmax</title>
        <section>Documentation Requirements</section>
        <snippet>Architecture Decision Records (ADRs) must document all significant technical choices with context, rationale, consequences, and alternatives considered. ADRs are immutable once accepted - new decisions supersede old ones rather than editing history.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown - dotmax</title>
        <section>Story 1.5: Create Architecture Decision Records (ADR) System</section>
        <snippet>ADRs are immutable (new ADRs supersede old ones, don't edit). Number format: 0001, 0002, etc. (sortable). Keep ADRs concise (1-2 pages max). Link ADRs from code comments where relevant. Critical for NFR-M2 (resumable development).</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Project Setup</title>
        <section>Open Questions - Question 3</section>
        <snippet>Should ADRs be numbered or dated? Recommendation: (A) Numbered (0001, 0002) - sortable, less prone to conflicts. Decision Owner: Developer (Story 1.5).</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/1-4-set-up-code-quality-tooling-clippy-rustfmt-deny.md</path>
        <title>Story 1.4: Set Up Code Quality Tooling</title>
        <section>Dev Agent Record - Completion Notes</section>
        <snippet>Key decision: Used deny.toml (not .deny.toml) because cargo-deny uses deny.toml by default - follow tool conventions for file naming. Documentation pattern: Added "Development > Code Quality" section to README.md with clear usage examples.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>src/lib.rs</path>
        <kind>library root</kind>
        <symbol>lib</symbol>
        <lines>1-25</lines>
        <reason>Main library file with module structure comments indicating Epic 2+ will add core modules. Shows current minimal state and provides context for where ADR references might be linked from code comments in future.</reason>
      </artifact>
      <artifact>
        <path>Cargo.toml</path>
        <kind>manifest</kind>
        <symbol>package</symbol>
        <lines>1-39</lines>
        <reason>Project metadata and dependency configuration. Dual licensing (MIT OR Apache-2.0) is a key architectural decision that may warrant an ADR. MSRV 1.70 is another architectural constraint.</reason>
      </artifact>
      <artifact>
        <path>.rustfmt.toml</path>
        <kind>configuration</kind>
        <symbol>rustfmt</symbol>
        <lines>1-10</lines>
        <reason>Code formatting configuration from Story 1.4. Demonstrates tool configuration file pattern (separate config file for tools with extensive options).</reason>
      </artifact>
      <artifact>
        <path>deny.toml</path>
        <kind>configuration</kind>
        <symbol>cargo-deny</symbol>
        <lines>1-37</lines>
        <reason>License and security policy configuration from Story 1.4. File naming convention (deny.toml not .deny.toml) follows tool convention - same pattern should apply to ADR files (follow standards).</reason>
      </artifact>
      <artifact>
        <path>README.md</path>
        <kind>documentation</kind>
        <symbol>README</symbol>
        <lines>34-91</lines>
        <reason>Development > Code Quality section added in Story 1.4. Provides pattern for clear, actionable documentation with usage examples. ADR README should follow similar style.</reason>
      </artifact>
    </code>
    <dependencies>
      <rust>
        <dependency name="ratatui" version="0.29" optional="false">Terminal UI framework (core)</dependency>
        <dependency name="crossterm" version="0.29" optional="false">Cross-platform terminal I/O (core)</dependency>
        <dependency name="thiserror" version="2.0" optional="false">Error handling derive macros (core)</dependency>
        <dependency name="tracing" version="0.1" optional="false">Structured logging (core)</dependency>
        <dependency name="image" version="0.25" optional="true">Image processing (feature-gated)</dependency>
        <dependency name="imageproc" version="0.24" optional="true">Image processing algorithms (feature-gated)</dependency>
        <dependency name="resvg" version="0.38" optional="true">SVG rendering (feature-gated)</dependency>
        <dependency name="usvg" version="0.38" optional="true">SVG parsing (feature-gated)</dependency>
      </rust>
      <rust-dev>
        <dependency name="criterion" version="0.7" features="html_reports">Benchmarking framework</dependency>
        <dependency name="tracing-subscriber" version="0.3">Tracing subscriber utilities</dependency>
      </rust-dev>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint category="documentation">
      <rule>ADRs must be immutable once status is "Accepted" - never edit accepted ADRs to change decisions</rule>
      <rationale>Preserves historical context and decision evolution. To change a decision, create new ADR that supersedes the old one.</rationale>
      <source>docs/epics.md#Story-1.5 Technical Notes</source>
    </constraint>
    <constraint category="documentation">
      <rule>ADR numbering format: 0001, 0002, 0003, etc. (four digits, zero-padded)</rule>
      <rationale>Sortable chronological order, no date conflicts, clear sequence</rationale>
      <source>docs/sprint-artifacts/tech-spec-epic-1.md#Open-Questions</source>
    </constraint>
    <constraint category="documentation">
      <rule>ADRs must be concise (1-2 pages maximum, 3-5 pages if complex decision)</rule>
      <rationale>Focus on decision, rationale, and alternatives - not implementation details. Link to architecture/PRD for detailed specs.</rationale>
      <source>docs/epics.md#Story-1.5 Technical Notes</source>
    </constraint>
    <constraint category="documentation">
      <rule>All ADRs must include five sections: Status, Context, Decision, Consequences, Alternatives Considered</rule>
      <rationale>Ensures complete decision documentation with trade-offs and rejected options for future reference</rationale>
      <source>docs/epics.md#Story-1.5 Acceptance Criteria</source>
    </constraint>
    <constraint category="architecture">
      <rule>ADR 0001 must document the braille unicode rendering decision (U+2800-U+28FF)</rule>
      <rationale>This is the most fundamental architectural choice for dotmax, affecting all Epic 2-6 designs</rationale>
      <source>docs/sprint-artifacts/1-5-create-architecture-decision-records-adr-system.md#Dev-Notes</source>
    </constraint>
    <constraint category="file-naming">
      <rule>Follow tool conventions for file naming (e.g., deny.toml not .deny.toml)</rule>
      <rationale>Tools have default file name expectations - following conventions reduces configuration overhead</rationale>
      <source>docs/sprint-artifacts/1-4-set-up-code-quality-tooling-clippy-rustfmt-deny.md#Dev-Agent-Record</source>
    </constraint>
    <constraint category="markdown">
      <rule>Use GitHub-flavored markdown for all documentation files</rule>
      <rationale>Ensures consistency and proper rendering on GitHub and in most markdown viewers</rationale>
      <source>docs/architecture.md#Documentation-Requirements</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>ADR File Structure</name>
      <kind>documentation template</kind>
      <signature>
        # ADR-NNNN: [Decision Title]
        **Status**: [Proposed | Accepted | Deprecated | Superseded by ADR-XXXX]
        **Date**: YYYY-MM-DD
        ## Context
        ## Decision
        ## Consequences
        ## Alternatives Considered
        ## References (optional)
      </signature>
      <path>docs/adr/template.md</path>
      <description>Standard ADR template structure - all ADRs must follow this format</description>
    </interface>
    <interface>
      <name>ADR Index Format</name>
      <kind>documentation index</kind>
      <signature>
        | Number | Title | Status | Date |
        |--------|-------|--------|------|
        | [0001](0001-decision-title.md) | Decision Title | Accepted | YYYY-MM-DD |
      </signature>
      <path>docs/adr/README.md</path>
      <description>README.md index table format - maintains chronological list of all ADRs with quick reference</description>
    </interface>
    <interface>
      <name>Code Comment ADR Reference</name>
      <kind>code annotation</kind>
      <signature>// See ADR-0001 for rationale on braille unicode choice</signature>
      <path>src/**/*.rs</path>
      <description>Pattern for linking code to ADRs - use "See ADR-NNNN" in comments where decisions are implemented</description>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Epic 1 requires no functional code tests as it focuses on project infrastructure and documentation.
      ADR system validation is manual:
      - Read through each ADR to verify clarity and completeness
      - Verify 0001 follows template structure exactly
      - Ensure README index matches created ADRs
      - Confirm all required sections present in template and first ADR
      - Validate markdown formatting (proper headers, lists, links)

      No cargo test additions needed for this story. Quality verification is documentation review only.
    </standards>
    <locations>
      No test files required for this story. Future stories (Epic 2+) will add tests to:
      - tests/ directory for integration tests
      - src/ inline #[cfg(test)] modules for unit tests
    </locations>
    <ideas>
      <test id="AC1">Manual: Verify docs/adr/ directory exists and is populated</test>
      <test id="AC2">Manual: Read docs/adr/README.md - verify index table present with guidelines</test>
      <test id="AC3">Manual: Read docs/adr/template.md - verify all 5 required sections present</test>
      <test id="AC4">Manual: Verify docs/adr/0001-use-braille-unicode-for-rendering.md exists</test>
      <test id="AC5">Manual: Verify template has Status, Context, Decision, Consequences, Alternatives Considered sections</test>
      <test id="AC6">Manual: Verify first ADR documents braille unicode decision with U+2800-U+28FF range</test>
      <test id="AC7">Manual: Verify first ADR Context section explains cross-platform requirement and protocol-free approach</test>
      <test id="AC8">Manual: Verify first ADR Consequences section lists 2×4 resolution, Unicode requirement, text-based output</test>
      <test id="AC9">Manual: Verify first ADR Alternatives section covers Sixel, Kitty protocol, ASCII art with rejection reasons</test>
      <test id="AC10">Manual: Verify README index table lists ADR 0001 with title, status (Accepted), and date</test>
    </ideas>
  </tests>
</story-context>
